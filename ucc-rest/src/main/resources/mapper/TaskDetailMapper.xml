<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.cucsi.bsd.ucc.common.mapper.TaskDetailMapper" >
  <resultMap id="BaseResultMap" type="cn.cucsi.bsd.ucc.data.domain.TaskDetail" >
    <id column="TASK_DETAIL_ID" property="taskDetailId" jdbcType="VARCHAR" />
    <result column="BUSINESS_CODE" property="businessCode" jdbcType="VARCHAR" />
    <result column="TASK_TYPE_ID" property="taskTypeId" jdbcType="VARCHAR" />
    <result column="DEPT_MESH_ID" property="deptMeshId" jdbcType="VARCHAR" />
    <result column="DEPT_AREA_ID" property="deptAreaId" jdbcType="VARCHAR" />
    <result column="DEPT_AGENCY_ID" property="deptAgencyId" jdbcType="VARCHAR" />
    <result column="TASK_CODE" property="taskCode" jdbcType="VARCHAR" />
    <result column="PRODUCT_TYPE" property="productType" jdbcType="VARCHAR" />
    <result column="PHONE_NUMBER" property="phoneNumber" jdbcType="VARCHAR" />
    <result column="RATE" property="rate" jdbcType="VARCHAR" />
    <result column="CUSTOMFIELDS1" property="customfields1" jdbcType="VARCHAR" />
    <result column="CUSTOMFIELDS2" property="customfields2" jdbcType="VARCHAR" />
    <result column="CUSTOMFIELDS3" property="customfields3" jdbcType="VARCHAR" />
    <result column="CUSTOMFIELDS4" property="customfields4" jdbcType="VARCHAR" />
    <result column="CUSTOMFIELDS5" property="customfields5" jdbcType="VARCHAR" />
    <result column="CUSTOMFIELDS6" property="customfields6" jdbcType="VARCHAR" />
    <result column="CUSTOMFIELDS7" property="customfields7" jdbcType="VARCHAR" />
    <result column="CUSTOMFIELDS8" property="customfields8" jdbcType="VARCHAR" />
    <result column="CUSTOMFIELDS9" property="customfields9" jdbcType="VARCHAR" />
    <result column="CUSTOMFIELDS10" property="customfields10" jdbcType="VARCHAR" />
    <result column="CUSTOMFIELDS11" property="customfields11" jdbcType="VARCHAR" />
    <result column="CUSTOMFIELDS12" property="customfields12" jdbcType="VARCHAR" />
    <result column="CUSTOMFIELDS13" property="customfields13" jdbcType="VARCHAR" />
    <result column="CUSTOMFIELDS14" property="customfields14" jdbcType="VARCHAR" />
    <result column="CUSTOMFIELDS15" property="customfields15" jdbcType="VARCHAR" />
    <result column="RESPONSIBLE" property="responsible" jdbcType="VARCHAR" />
    <result column="NET_STOP" property="netStop" jdbcType="VARCHAR" />
    <result column="PACKAGE_NAME" property="packageName" jdbcType="VARCHAR" />
    <result column="CONTRACT_NAME" property="contractName" jdbcType="VARCHAR" />
    <result column="CONTRACT_START_TIME" property="contractStartTime" jdbcType="VARCHAR" />
    <result column="CONTRACT_END_TIME" property="contractEndTime" jdbcType="VARCHAR" />
    <result column="ACTIVATION_TIME" property="activationTime" jdbcType="VARCHAR" />
    <result column="DEVELOPMENT_DEPT" property="developmentDept" jdbcType="VARCHAR" />
    <result column="IMPORT_BATCH" property="importBatch" jdbcType="VARCHAR" />
    <result column="IMPORT_PERSON_ID" property="importPersonId" jdbcType="VARCHAR" />
    <result column="IMPORT_TIME" property="importTime" jdbcType="TIMESTAMP" />
    <result column="CONTACTS" property="contacts" jdbcType="VARCHAR" />
    <result column="STATUS" property="status" jdbcType="VARCHAR" />
    <result column="INSTALLED_ADDRESS" property="installedAddress" jdbcType="VARCHAR" />
    <result column="PON_LOGO" property="ponLogo" jdbcType="VARCHAR" />
    <result column="TARIFF_NAME" property="tariffName" jdbcType="VARCHAR" />
    <result column="PHONE_NUMBER2" property="phoneNumber2" jdbcType="VARCHAR" />
    <result column="PHONE_NUMBER3" property="phoneNumber3" jdbcType="VARCHAR" />
    <result column="TASK_STATUS" property="taskStatus" jdbcType="VARCHAR" />
    <result column="ROPERATE_DEPT_ID" property="roperateDeptId" jdbcType="VARCHAR" />
    <result column="USER_NAME" property="userName" jdbcType="VARCHAR" />
    <result column="DEFULT_PHONE" property="defultPhone" jdbcType="VARCHAR" />
    <result column="INIT_DEVELOPMENT" property="initDevelopment" jdbcType="VARCHAR" />
    <result column="INIT_MESH_ID" property="initMeshId" jdbcType="VARCHAR" />
    <result column="INIT_AREA_ID" property="initAreaId" jdbcType="VARCHAR" />
    <result column="END_DATE" property="endDate" jdbcType="TIMESTAMP" />
    <result column="USER_ID" property="userId" jdbcType="VARCHAR" />
    <result column="customer_phone" property="customerPhone" jdbcType="VARCHAR" />
    <result column="cust_name" property="custName" jdbcType="VARCHAR" />
    <result column="cust_id" property="custId" jdbcType="VARCHAR" />
    <result column="TRANSFER_STATUS" property="transferStatus" jdbcType="VARCHAR" />
    <result column="CALL_MEMO" property="callMemo" jdbcType="VARCHAR" />
    <result column="CALL_RESULT" property="callResult" jdbcType="VARCHAR" />
    <result column="domain_id" property="domainId" jdbcType="VARCHAR" />
    <result column="TASK_TYPE_NAME" property="taskTypeName" jdbcType="VARCHAR" />
    <result column="OPERATOR_ID" property="operatorId" jdbcType="VARCHAR" />
    <result column="TRANSFER_TIME" property="transferTime" jdbcType="TIMESTAMP" />
    <result column="nick_name" property="nickName" jdbcType="VARCHAR" />
    <result column="dept_name" property="deptName" jdbcType="VARCHAR" />
    <result column="CDR_ID" property="cdrId" jdbcType="VARCHAR" />
    <result column="DEPT_MESH_NAME" property="deptMeshName" jdbcType="VARCHAR" />
    <result column="DEPT_AREA_NAME" property="deptAreaName" jdbcType="VARCHAR" />
    <result column="DEVELOPMENT_DEPT_NAME" property="developmentDeptName" jdbcType="VARCHAR" />
    <result column="check_flag" property="checkFlag" jdbcType="VARCHAR" />

  </resultMap>
  <sql id="Base_Column_List" >
    TASK_DETAIL_ID, BUSINESS_CODE, TASK_TYPE_ID, DEPT_MESH_ID, DEPT_AREA_ID, DEPT_AGENCY_ID, 
    TASK_CODE, PRODUCT_TYPE, PHONE_NUMBER, RATE, CUSTOMFIELDS1, CUSTOMFIELDS2, CUSTOMFIELDS3, 
    CUSTOMFIELDS4, CUSTOMFIELDS5, CUSTOMFIELDS6, CUSTOMFIELDS7, CUSTOMFIELDS8, CUSTOMFIELDS9, 
    CUSTOMFIELDS10, CUSTOMFIELDS11, CUSTOMFIELDS12, CUSTOMFIELDS13, CUSTOMFIELDS14, CUSTOMFIELDS15, 
    RESPONSIBLE, NET_STOP, PACKAGE_NAME, CONTRACT_NAME, CONTRACT_START_TIME, CONTRACT_END_TIME, 
    ACTIVATION_TIME, DEVELOPMENT_DEPT, IMPORT_BATCH, IMPORT_PERSON_ID, IMPORT_TIME, CONTACTS, 
    STATUS, INSTALLED_ADDRESS, PON_LOGO, TARIFF_NAME, PHONE_NUMBER2, PHONE_NUMBER3, TASK_STATUS, 
    ROPERATE_DEPT_ID, USER_NAME, DEFULT_PHONE, INIT_DEVELOPMENT, INIT_MESH_ID, INIT_AREA_ID, 
    END_DATE, USER_ID,domain_id,check_flag
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="cn.cucsi.bsd.ucc.common.beans.ShowTaskDetailCriteria" >
    SELECT
        a.*, c.cust_name AS cust_name,
        c.defult_phone AS customer_phone,
        b.CALL_MEMO,
        b.CALL_RESULT,
        b.TRANSFER_STATUS,
        max(b.TRANSFER_TIME)
    FROM
        OC_TASK_DETAIL AS a
    LEFT JOIN ucc_customers AS c ON a.domain_id = c.domain_id AND a.BUSINESS_CODE = c.businesscode
    LEFT JOIN OC_TASK_TRANSFER AS b ON a.TASK_DETAIL_ID = b.TASK_DETAIL_ID
    where 1=1
    AND a.BUSINESS_CODE = #{businessCode,jdbcType=VARCHAR}
    AND a.domain_id = #{domainId,jdbcType=VARCHAR}
  </select>

  <!-- 主键查询 -->
  <select id="selectByPrimaryKeyForWEB" resultMap="BaseResultMap"
          parameterType="java.lang.String">
    select DISTINCT
      d.TASK_DETAIL_ID, d.BUSINESS_CODE, d.TASK_TYPE_ID, d.DEPT_MESH_ID,
      d.DEPT_AREA_ID,
      d.DEPT_AGENCY_ID,
      d.TASK_CODE,  d.PHONE_NUMBER,
      d.CUSTOMFIELDS1, d.CUSTOMFIELDS2,
      d.CUSTOMFIELDS3,
      d.CUSTOMFIELDS4,
      d.CUSTOMFIELDS5, d.CUSTOMFIELDS6, d.CUSTOMFIELDS7, d.CUSTOMFIELDS8,
      d.CUSTOMFIELDS9,
      d.CUSTOMFIELDS10, d.CUSTOMFIELDS11, d.CUSTOMFIELDS12,
      d.CUSTOMFIELDS13, d.CUSTOMFIELDS14,
      d.CUSTOMFIELDS15,
      d.RESPONSIBLE, d.NET_STOP,
      d.PACKAGE_NAME, d.CONTRACT_NAME, d.CONTRACT_START_TIME,
      d.CONTRACT_END_TIME,
      d.ACTIVATION_TIME, d.DEVELOPMENT_DEPT, d.IMPORT_BATCH, d.IMPORT_PERSON_ID,
      d.IMPORT_TIME,
      d.PHONE_NUMBER2, d.PHONE_NUMBER3,
      d.TASK_STATUS, d.ROPERATE_DEPT_ID,
      d.DEFULT_PHONE,
      d.USER_NAME,
      c.contacts CONTACTS,
      c.status STATUS,
      c.installedaddress INSTALLED_ADDRESS,
      c.ponlogo PON_LOGO,
      c.tariffname TARIFF_NAME,
      c.PRODUCT_TYPE PRODUCT_TYPE,
      c.RATE RATE ,
      d.END_DATE,
      p1.dept_name DEPT_MESH_NAME,
      p2.dept_name DEPT_AREA_NAME,
      p3.dept_name DEVELOPMENT_DEPT_NAME
    from OC_TASK_DETAIL d left join ucc_customers c on c.businesscode = d.BUSINESS_CODE and c.domain_id = d.domain_id
    LEFT JOIN ucc_depts p1 ON d.DEPT_MESH_ID = p1.dept_id
    LEFT JOIN ucc_depts p2 ON d.DEPT_AREA_ID = p2.dept_id
    LEFT JOIN ucc_depts p3 ON d.DEVELOPMENT_DEPT = p3.dept_id
    where d.TASK_DETAIL_ID=#{taskDetailId}
  </select>

  <delete id="deleteByPrimaryKey" parameterType="java.lang.String" >
    delete from OC_TASK_DETAIL
    where TASK_DETAIL_ID = #{taskDetailId,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="cn.cucsi.bsd.ucc.data.domain.TaskDetail" >
    insert into OC_TASK_DETAIL (TASK_DETAIL_ID, BUSINESS_CODE, TASK_TYPE_ID, 
      DEPT_MESH_ID, DEPT_AREA_ID, DEPT_AGENCY_ID, 
      TASK_CODE, PRODUCT_TYPE, PHONE_NUMBER, 
      RATE, CUSTOMFIELDS1, CUSTOMFIELDS2, 
      CUSTOMFIELDS3, CUSTOMFIELDS4, CUSTOMFIELDS5, 
      CUSTOMFIELDS6, CUSTOMFIELDS7, CUSTOMFIELDS8, 
      CUSTOMFIELDS9, CUSTOMFIELDS10, CUSTOMFIELDS11, 
      CUSTOMFIELDS12, CUSTOMFIELDS13, CUSTOMFIELDS14, 
      CUSTOMFIELDS15, RESPONSIBLE, NET_STOP, 
      PACKAGE_NAME, CONTRACT_NAME, CONTRACT_START_TIME, 
      CONTRACT_END_TIME, ACTIVATION_TIME, DEVELOPMENT_DEPT, 
      IMPORT_BATCH, IMPORT_PERSON_ID, IMPORT_TIME, 
      CONTACTS, STATUS, INSTALLED_ADDRESS, 
      PON_LOGO, TARIFF_NAME, PHONE_NUMBER2, 
      PHONE_NUMBER3, TASK_STATUS, ROPERATE_DEPT_ID, 
      USER_NAME, DEFULT_PHONE, INIT_DEVELOPMENT, 
      INIT_MESH_ID, INIT_AREA_ID, END_DATE, 
      USER_ID,domain_id)
    values (#{taskDetailId,jdbcType=VARCHAR}, #{businessCode,jdbcType=VARCHAR}, #{taskTypeId,jdbcType=VARCHAR}, 
      #{deptMeshId,jdbcType=VARCHAR}, #{deptAreaId,jdbcType=VARCHAR}, #{deptAgencyId,jdbcType=VARCHAR}, 
      #{taskCode,jdbcType=VARCHAR}, #{productType,jdbcType=VARCHAR}, #{phoneNumber,jdbcType=VARCHAR}, 
      #{rate,jdbcType=VARCHAR}, #{customfields1,jdbcType=VARCHAR}, #{customfields2,jdbcType=VARCHAR}, 
      #{customfields3,jdbcType=VARCHAR}, #{customfields4,jdbcType=VARCHAR}, #{customfields5,jdbcType=VARCHAR}, 
      #{customfields6,jdbcType=VARCHAR}, #{customfields7,jdbcType=VARCHAR}, #{customfields8,jdbcType=VARCHAR}, 
      #{customfields9,jdbcType=VARCHAR}, #{customfields10,jdbcType=VARCHAR}, #{customfields11,jdbcType=VARCHAR}, 
      #{customfields12,jdbcType=VARCHAR}, #{customfields13,jdbcType=VARCHAR}, #{customfields14,jdbcType=VARCHAR}, 
      #{customfields15,jdbcType=VARCHAR}, #{responsible,jdbcType=VARCHAR}, #{netStop,jdbcType=VARCHAR}, 
      #{packageName,jdbcType=VARCHAR}, #{contractName,jdbcType=VARCHAR}, #{contractStartTime,jdbcType=VARCHAR}, 
      #{contractEndTime,jdbcType=VARCHAR}, #{activationTime,jdbcType=VARCHAR}, #{developmentDept,jdbcType=VARCHAR}, 
      #{importBatch,jdbcType=VARCHAR}, #{importPersonId,jdbcType=VARCHAR}, #{importTime,jdbcType=TIMESTAMP}, 
      #{contacts,jdbcType=VARCHAR}, #{status,jdbcType=VARCHAR}, #{installedAddress,jdbcType=VARCHAR}, 
      #{ponLogo,jdbcType=VARCHAR}, #{tariffName,jdbcType=VARCHAR}, #{phoneNumber2,jdbcType=VARCHAR}, 
      #{phoneNumber3,jdbcType=VARCHAR}, #{taskStatus,jdbcType=VARCHAR}, #{roperateDeptId,jdbcType=VARCHAR}, 
      #{userName,jdbcType=VARCHAR}, #{defultPhone,jdbcType=VARCHAR}, #{initDevelopment,jdbcType=VARCHAR}, 
      #{initMeshId,jdbcType=VARCHAR}, #{initAreaId,jdbcType=VARCHAR}, #{endDate,jdbcType=TIMESTAMP}, 
      #{userId,jdbcType=VARCHAR},#{domainId,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="cn.cucsi.bsd.ucc.data.domain.TaskDetail" >
    insert into OC_TASK_DETAIL
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="taskDetailId != null" >
        TASK_DETAIL_ID,
      </if>
      <if test="businessCode != null" >
        BUSINESS_CODE,
      </if>
      <if test="taskTypeId != null" >
        TASK_TYPE_ID,
      </if>
      <if test="deptMeshId != null" >
        DEPT_MESH_ID,
      </if>
      <if test="deptAreaId != null" >
        DEPT_AREA_ID,
      </if>
      <if test="deptAgencyId != null" >
        DEPT_AGENCY_ID,
      </if>
      <if test="taskCode != null" >
        TASK_CODE,
      </if>
      <if test="productType != null" >
        PRODUCT_TYPE,
      </if>
      <if test="phoneNumber != null" >
        PHONE_NUMBER,
      </if>
      <if test="rate != null" >
        RATE,
      </if>
      <if test="customfields1 != null" >
        CUSTOMFIELDS1,
      </if>
      <if test="customfields2 != null" >
        CUSTOMFIELDS2,
      </if>
      <if test="customfields3 != null" >
        CUSTOMFIELDS3,
      </if>
      <if test="customfields4 != null" >
        CUSTOMFIELDS4,
      </if>
      <if test="customfields5 != null" >
        CUSTOMFIELDS5,
      </if>
      <if test="customfields6 != null" >
        CUSTOMFIELDS6,
      </if>
      <if test="customfields7 != null" >
        CUSTOMFIELDS7,
      </if>
      <if test="customfields8 != null" >
        CUSTOMFIELDS8,
      </if>
      <if test="customfields9 != null" >
        CUSTOMFIELDS9,
      </if>
      <if test="customfields10 != null" >
        CUSTOMFIELDS10,
      </if>
      <if test="customfields11 != null" >
        CUSTOMFIELDS11,
      </if>
      <if test="customfields12 != null" >
        CUSTOMFIELDS12,
      </if>
      <if test="customfields13 != null" >
        CUSTOMFIELDS13,
      </if>
      <if test="customfields14 != null" >
        CUSTOMFIELDS14,
      </if>
      <if test="customfields15 != null" >
        CUSTOMFIELDS15,
      </if>
      <if test="responsible != null" >
        RESPONSIBLE,
      </if>
      <if test="netStop != null" >
        NET_STOP,
      </if>
      <if test="packageName != null" >
        PACKAGE_NAME,
      </if>
      <if test="contractName != null" >
        CONTRACT_NAME,
      </if>
      <if test="contractStartTime != null" >
        CONTRACT_START_TIME,
      </if>
      <if test="contractEndTime != null" >
        CONTRACT_END_TIME,
      </if>
      <if test="activationTime != null" >
        ACTIVATION_TIME,
      </if>
      <if test="developmentDept != null" >
        DEVELOPMENT_DEPT,
      </if>
      <if test="importBatch != null" >
        IMPORT_BATCH,
      </if>
      <if test="importPersonId != null" >
        IMPORT_PERSON_ID,
      </if>
      <if test="importTime != null" >
        IMPORT_TIME,
      </if>
      <if test="contacts != null" >
        CONTACTS,
      </if>
      <if test="status != null" >
        STATUS,
      </if>
      <if test="installedAddress != null" >
        INSTALLED_ADDRESS,
      </if>
      <if test="ponLogo != null" >
        PON_LOGO,
      </if>
      <if test="tariffName != null" >
        TARIFF_NAME,
      </if>
      <if test="phoneNumber2 != null" >
        PHONE_NUMBER2,
      </if>
      <if test="phoneNumber3 != null" >
        PHONE_NUMBER3,
      </if>
      <if test="taskStatus != null" >
        TASK_STATUS,
      </if>
      <if test="roperateDeptId != null" >
        ROPERATE_DEPT_ID,
      </if>
      <if test="userName != null" >
        USER_NAME,
      </if>
      <if test="defultPhone != null" >
        DEFULT_PHONE,
      </if>
      <if test="initDevelopment != null" >
        INIT_DEVELOPMENT,
      </if>
      <if test="initMeshId != null" >
        INIT_MESH_ID,
      </if>
      <if test="initAreaId != null" >
        INIT_AREA_ID,
      </if>
      <if test="endDate != null" >
        END_DATE,
      </if>
      <if test="userId != null" >
        USER_ID,
      </if>
      <if test="domainId != null" >
        domain_id,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="taskDetailId != null" >
        #{taskDetailId,jdbcType=VARCHAR},
      </if>
      <if test="businessCode != null" >
        #{businessCode,jdbcType=VARCHAR},
      </if>
      <if test="taskTypeId != null" >
        #{taskTypeId,jdbcType=VARCHAR},
      </if>
      <if test="deptMeshId != null" >
        #{deptMeshId,jdbcType=VARCHAR},
      </if>
      <if test="deptAreaId != null" >
        #{deptAreaId,jdbcType=VARCHAR},
      </if>
      <if test="deptAgencyId != null" >
        #{deptAgencyId,jdbcType=VARCHAR},
      </if>
      <if test="taskCode != null" >
        #{taskCode,jdbcType=VARCHAR},
      </if>
      <if test="productType != null" >
        #{productType,jdbcType=VARCHAR},
      </if>
      <if test="phoneNumber != null" >
        #{phoneNumber,jdbcType=VARCHAR},
      </if>
      <if test="rate != null" >
        #{rate,jdbcType=VARCHAR},
      </if>
      <if test="customfields1 != null" >
        #{customfields1,jdbcType=VARCHAR},
      </if>
      <if test="customfields2 != null" >
        #{customfields2,jdbcType=VARCHAR},
      </if>
      <if test="customfields3 != null" >
        #{customfields3,jdbcType=VARCHAR},
      </if>
      <if test="customfields4 != null" >
        #{customfields4,jdbcType=VARCHAR},
      </if>
      <if test="customfields5 != null" >
        #{customfields5,jdbcType=VARCHAR},
      </if>
      <if test="customfields6 != null" >
        #{customfields6,jdbcType=VARCHAR},
      </if>
      <if test="customfields7 != null" >
        #{customfields7,jdbcType=VARCHAR},
      </if>
      <if test="customfields8 != null" >
        #{customfields8,jdbcType=VARCHAR},
      </if>
      <if test="customfields9 != null" >
        #{customfields9,jdbcType=VARCHAR},
      </if>
      <if test="customfields10 != null" >
        #{customfields10,jdbcType=VARCHAR},
      </if>
      <if test="customfields11 != null" >
        #{customfields11,jdbcType=VARCHAR},
      </if>
      <if test="customfields12 != null" >
        #{customfields12,jdbcType=VARCHAR},
      </if>
      <if test="customfields13 != null" >
        #{customfields13,jdbcType=VARCHAR},
      </if>
      <if test="customfields14 != null" >
        #{customfields14,jdbcType=VARCHAR},
      </if>
      <if test="customfields15 != null" >
        #{customfields15,jdbcType=VARCHAR},
      </if>
      <if test="responsible != null" >
        #{responsible,jdbcType=VARCHAR},
      </if>
      <if test="netStop != null" >
        #{netStop,jdbcType=VARCHAR},
      </if>
      <if test="packageName != null" >
        #{packageName,jdbcType=VARCHAR},
      </if>
      <if test="contractName != null" >
        #{contractName,jdbcType=VARCHAR},
      </if>
      <if test="contractStartTime != null" >
        #{contractStartTime,jdbcType=VARCHAR},
      </if>
      <if test="contractEndTime != null" >
        #{contractEndTime,jdbcType=VARCHAR},
      </if>
      <if test="activationTime != null" >
        #{activationTime,jdbcType=VARCHAR},
      </if>
      <if test="developmentDept != null" >
        #{developmentDept,jdbcType=VARCHAR},
      </if>
      <if test="importBatch != null" >
        #{importBatch,jdbcType=VARCHAR},
      </if>
      <if test="importPersonId != null" >
        #{importPersonId,jdbcType=VARCHAR},
      </if>
      <if test="importTime != null" >
        #{importTime,jdbcType=TIMESTAMP},
      </if>
      <if test="contacts != null" >
        #{contacts,jdbcType=VARCHAR},
      </if>
      <if test="status != null" >
        #{status,jdbcType=VARCHAR},
      </if>
      <if test="installedAddress != null" >
        #{installedAddress,jdbcType=VARCHAR},
      </if>
      <if test="ponLogo != null" >
        #{ponLogo,jdbcType=VARCHAR},
      </if>
      <if test="tariffName != null" >
        #{tariffName,jdbcType=VARCHAR},
      </if>
      <if test="phoneNumber2 != null" >
        #{phoneNumber2,jdbcType=VARCHAR},
      </if>
      <if test="phoneNumber3 != null" >
        #{phoneNumber3,jdbcType=VARCHAR},
      </if>
      <if test="taskStatus != null" >
        #{taskStatus,jdbcType=VARCHAR},
      </if>
      <if test="roperateDeptId != null" >
        #{roperateDeptId,jdbcType=VARCHAR},
      </if>
      <if test="userName != null" >
        #{userName,jdbcType=VARCHAR},
      </if>
      <if test="defultPhone != null" >
        #{defultPhone,jdbcType=VARCHAR},
      </if>
      <if test="initDevelopment != null" >
        #{initDevelopment,jdbcType=VARCHAR},
      </if>
      <if test="initMeshId != null" >
        #{initMeshId,jdbcType=VARCHAR},
      </if>
      <if test="initAreaId != null" >
        #{initAreaId,jdbcType=VARCHAR},
      </if>
      <if test="endDate != null" >
        #{endDate,jdbcType=TIMESTAMP},
      </if>
      <if test="userId != null" >
        #{userId,jdbcType=VARCHAR},
      </if>
      <if test="domainId != null" >
        #{domainId,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="cn.cucsi.bsd.ucc.data.domain.TaskDetail" >
    update OC_TASK_DETAIL
    <set >
      <if test="businessCode != null" >
        BUSINESS_CODE = #{businessCode,jdbcType=VARCHAR},
      </if>
      <if test="taskTypeId != null" >
        TASK_TYPE_ID = #{taskTypeId,jdbcType=VARCHAR},
      </if>
      <if test="deptMeshId != null" >
        DEPT_MESH_ID = #{deptMeshId,jdbcType=VARCHAR},
      </if>
      <if test="deptAreaId != null" >
        DEPT_AREA_ID = #{deptAreaId,jdbcType=VARCHAR},
      </if>
      <if test="deptAgencyId != null" >
        DEPT_AGENCY_ID = #{deptAgencyId,jdbcType=VARCHAR},
      </if>
      <if test="taskCode != null" >
        TASK_CODE = #{taskCode,jdbcType=VARCHAR},
      </if>
      <if test="productType != null" >
        PRODUCT_TYPE = #{productType,jdbcType=VARCHAR},
      </if>
      <if test="phoneNumber != null" >
        PHONE_NUMBER = #{phoneNumber,jdbcType=VARCHAR},
      </if>
      <if test="rate != null" >
        RATE = #{rate,jdbcType=VARCHAR},
      </if>
      <if test="customfields1 != null" >
        CUSTOMFIELDS1 = #{customfields1,jdbcType=VARCHAR},
      </if>
      <if test="customfields2 != null" >
        CUSTOMFIELDS2 = #{customfields2,jdbcType=VARCHAR},
      </if>
      <if test="customfields3 != null" >
        CUSTOMFIELDS3 = #{customfields3,jdbcType=VARCHAR},
      </if>
      <if test="customfields4 != null" >
        CUSTOMFIELDS4 = #{customfields4,jdbcType=VARCHAR},
      </if>
      <if test="customfields5 != null" >
        CUSTOMFIELDS5 = #{customfields5,jdbcType=VARCHAR},
      </if>
      <if test="customfields6 != null" >
        CUSTOMFIELDS6 = #{customfields6,jdbcType=VARCHAR},
      </if>
      <if test="customfields7 != null" >
        CUSTOMFIELDS7 = #{customfields7,jdbcType=VARCHAR},
      </if>
      <if test="customfields8 != null" >
        CUSTOMFIELDS8 = #{customfields8,jdbcType=VARCHAR},
      </if>
      <if test="customfields9 != null" >
        CUSTOMFIELDS9 = #{customfields9,jdbcType=VARCHAR},
      </if>
      <if test="customfields10 != null" >
        CUSTOMFIELDS10 = #{customfields10,jdbcType=VARCHAR},
      </if>
      <if test="customfields11 != null" >
        CUSTOMFIELDS11 = #{customfields11,jdbcType=VARCHAR},
      </if>
      <if test="customfields12 != null" >
        CUSTOMFIELDS12 = #{customfields12,jdbcType=VARCHAR},
      </if>
      <if test="customfields13 != null" >
        CUSTOMFIELDS13 = #{customfields13,jdbcType=VARCHAR},
      </if>
      <if test="customfields14 != null" >
        CUSTOMFIELDS14 = #{customfields14,jdbcType=VARCHAR},
      </if>
      <if test="customfields15 != null" >
        CUSTOMFIELDS15 = #{customfields15,jdbcType=VARCHAR},
      </if>
      <if test="responsible != null" >
        RESPONSIBLE = #{responsible,jdbcType=VARCHAR},
      </if>
      <if test="netStop != null" >
        NET_STOP = #{netStop,jdbcType=VARCHAR},
      </if>
      <if test="packageName != null" >
        PACKAGE_NAME = #{packageName,jdbcType=VARCHAR},
      </if>
      <if test="contractName != null" >
        CONTRACT_NAME = #{contractName,jdbcType=VARCHAR},
      </if>
      <if test="contractStartTime != null" >
        CONTRACT_START_TIME = #{contractStartTime,jdbcType=VARCHAR},
      </if>
      <if test="contractEndTime != null" >
        CONTRACT_END_TIME = #{contractEndTime,jdbcType=VARCHAR},
      </if>
      <if test="activationTime != null" >
        ACTIVATION_TIME = #{activationTime,jdbcType=VARCHAR},
      </if>
      <if test="developmentDept != null" >
        DEVELOPMENT_DEPT = #{developmentDept,jdbcType=VARCHAR},
      </if>
      <if test="importBatch != null" >
        IMPORT_BATCH = #{importBatch,jdbcType=VARCHAR},
      </if>
      <if test="importPersonId != null" >
        IMPORT_PERSON_ID = #{importPersonId,jdbcType=VARCHAR},
      </if>
      <if test="importTime != null" >
        IMPORT_TIME = #{importTime,jdbcType=TIMESTAMP},
      </if>
      <if test="contacts != null" >
        CONTACTS = #{contacts,jdbcType=VARCHAR},
      </if>
      <if test="status != null" >
        STATUS = #{status,jdbcType=VARCHAR},
      </if>
      <if test="installedAddress != null" >
        INSTALLED_ADDRESS = #{installedAddress,jdbcType=VARCHAR},
      </if>
      <if test="ponLogo != null" >
        PON_LOGO = #{ponLogo,jdbcType=VARCHAR},
      </if>
      <if test="tariffName != null" >
        TARIFF_NAME = #{tariffName,jdbcType=VARCHAR},
      </if>
      <if test="phoneNumber2 != null" >
        PHONE_NUMBER2 = #{phoneNumber2,jdbcType=VARCHAR},
      </if>
      <if test="phoneNumber3 != null" >
        PHONE_NUMBER3 = #{phoneNumber3,jdbcType=VARCHAR},
      </if>
      <if test="taskStatus != null" >
        TASK_STATUS = #{taskStatus,jdbcType=VARCHAR},
      </if>
      <if test="roperateDeptId != null" >
        ROPERATE_DEPT_ID = #{roperateDeptId,jdbcType=VARCHAR},
      </if>
      <if test="userName != null" >
        USER_NAME = #{userName,jdbcType=VARCHAR},
      </if>
      <if test="defultPhone != null" >
        DEFULT_PHONE = #{defultPhone,jdbcType=VARCHAR},
      </if>
      <if test="initDevelopment != null" >
        INIT_DEVELOPMENT = #{initDevelopment,jdbcType=VARCHAR},
      </if>
      <if test="initMeshId != null" >
        INIT_MESH_ID = #{initMeshId,jdbcType=VARCHAR},
      </if>
      <if test="initAreaId != null" >
        INIT_AREA_ID = #{initAreaId,jdbcType=VARCHAR},
      </if>
      <if test="endDate != null" >
        END_DATE = #{endDate,jdbcType=TIMESTAMP},
      </if>
      <if test="userId != null" >
        USER_ID = #{userId,jdbcType=VARCHAR},
      </if>
      <if test="domainId != null" >
        domain_id = #{domainId,jdbcType=VARCHAR},
      </if>
    </set>
    where TASK_DETAIL_ID = #{taskDetailId,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="cn.cucsi.bsd.ucc.data.domain.TaskDetail" >
    update OC_TASK_DETAIL
    set BUSINESS_CODE = #{businessCode,jdbcType=VARCHAR},
      TASK_TYPE_ID = #{taskTypeId,jdbcType=VARCHAR},
      DEPT_MESH_ID = #{deptMeshId,jdbcType=VARCHAR},
      DEPT_AREA_ID = #{deptAreaId,jdbcType=VARCHAR},
      DEPT_AGENCY_ID = #{deptAgencyId,jdbcType=VARCHAR},
      TASK_CODE = #{taskCode,jdbcType=VARCHAR},
      PRODUCT_TYPE = #{productType,jdbcType=VARCHAR},
      PHONE_NUMBER = #{phoneNumber,jdbcType=VARCHAR},
      RATE = #{rate,jdbcType=VARCHAR},
      CUSTOMFIELDS1 = #{customfields1,jdbcType=VARCHAR},
      CUSTOMFIELDS2 = #{customfields2,jdbcType=VARCHAR},
      CUSTOMFIELDS3 = #{customfields3,jdbcType=VARCHAR},
      CUSTOMFIELDS4 = #{customfields4,jdbcType=VARCHAR},
      CUSTOMFIELDS5 = #{customfields5,jdbcType=VARCHAR},
      CUSTOMFIELDS6 = #{customfields6,jdbcType=VARCHAR},
      CUSTOMFIELDS7 = #{customfields7,jdbcType=VARCHAR},
      CUSTOMFIELDS8 = #{customfields8,jdbcType=VARCHAR},
      CUSTOMFIELDS9 = #{customfields9,jdbcType=VARCHAR},
      CUSTOMFIELDS10 = #{customfields10,jdbcType=VARCHAR},
      CUSTOMFIELDS11 = #{customfields11,jdbcType=VARCHAR},
      CUSTOMFIELDS12 = #{customfields12,jdbcType=VARCHAR},
      CUSTOMFIELDS13 = #{customfields13,jdbcType=VARCHAR},
      CUSTOMFIELDS14 = #{customfields14,jdbcType=VARCHAR},
      CUSTOMFIELDS15 = #{customfields15,jdbcType=VARCHAR},
      RESPONSIBLE = #{responsible,jdbcType=VARCHAR},
      NET_STOP = #{netStop,jdbcType=VARCHAR},
      PACKAGE_NAME = #{packageName,jdbcType=VARCHAR},
      CONTRACT_NAME = #{contractName,jdbcType=VARCHAR},
      CONTRACT_START_TIME = #{contractStartTime,jdbcType=VARCHAR},
      CONTRACT_END_TIME = #{contractEndTime,jdbcType=VARCHAR},
      ACTIVATION_TIME = #{activationTime,jdbcType=VARCHAR},
      DEVELOPMENT_DEPT = #{developmentDept,jdbcType=VARCHAR},
      IMPORT_BATCH = #{importBatch,jdbcType=VARCHAR},
      IMPORT_PERSON_ID = #{importPersonId,jdbcType=VARCHAR},
      IMPORT_TIME = #{importTime,jdbcType=TIMESTAMP},
      CONTACTS = #{contacts,jdbcType=VARCHAR},
      STATUS = #{status,jdbcType=VARCHAR},
      INSTALLED_ADDRESS = #{installedAddress,jdbcType=VARCHAR},
      PON_LOGO = #{ponLogo,jdbcType=VARCHAR},
      TARIFF_NAME = #{tariffName,jdbcType=VARCHAR},
      PHONE_NUMBER2 = #{phoneNumber2,jdbcType=VARCHAR},
      PHONE_NUMBER3 = #{phoneNumber3,jdbcType=VARCHAR},
      TASK_STATUS = #{taskStatus,jdbcType=VARCHAR},
      ROPERATE_DEPT_ID = #{roperateDeptId,jdbcType=VARCHAR},
      USER_NAME = #{userName,jdbcType=VARCHAR},
      DEFULT_PHONE = #{defultPhone,jdbcType=VARCHAR},
      INIT_DEVELOPMENT = #{initDevelopment,jdbcType=VARCHAR},
      INIT_MESH_ID = #{initMeshId,jdbcType=VARCHAR},
      INIT_AREA_ID = #{initAreaId,jdbcType=VARCHAR},
      END_DATE = #{endDate,jdbcType=TIMESTAMP},
      USER_ID = #{userId,jdbcType=VARCHAR},
      domain_id = #{domainId,jdbcType=VARCHAR}
    where TASK_DETAIL_ID = #{taskDetailId,jdbcType=VARCHAR}
  </update>

  <!-- 查询外呼任务列表 add by wangxiaoyu 2018-08-29-->
  <select id="selectDetailByUserId" resultMap="BaseResultMap"
          parameterType="cn.cucsi.bsd.ucc.common.beans.OngoingTaskCriteria">
    SELECT
      a.BUSINESS_CODE,
      a.USER_ID,
      uu.domain_id,
      a.TASK_DETAIL_ID,
      a.TASK_CODE,
      <if test="taskCountsFlag != null">
      a.TASK_STATUS,
      </if>
      b.defult_phone as customer_phone,
      b.cust_name as cust_name,
      b.cust_id as cust_id
    FROM
      OC_TASK_DETAIL AS a
    LEFT JOIN ucc_customers AS b ON a.BUSINESS_CODE = b.businesscode and a.domain_id = b.domain_id
    LEFT JOIN ucc_users AS uu ON a.USER_ID = uu.user_id
    <if test='taskCountsFlag != null and taskCountsFlag =="2" '>
    LEFT JOIN OC_TASK_TRANSFER AS t on a.TASK_DETAIL_ID = t.TASK_DETAIL_ID
    </if>
    WHERE
       1 = 1
    <if test='taskCode != null and taskCode !="" '>
    AND a.TASK_CODE &lt; #{taskCode,jdbcType=VARCHAR}*1
    </if>
    AND a.USER_ID = #{userId,jdbcType=VARCHAR}
    <if test='taskCountsFlag == null or taskCountsFlag =="" '>
      AND a.TASK_STATUS IN ('2', '3')
    </if>
    <if test='taskCountsFlag != null and taskCountsFlag =="1" '>
      AND a.TASK_STATUS = '1'
    </if>
    <if test='taskCountsFlag != null and taskCountsFlag =="0" '>
      AND a.TASK_STATUS IN ('2', '3')
    </if>
    <if test='taskCountsFlag != null and taskCountsFlag =="2" '>
      AND a.TASK_STATUS = '4'
      AND t.TRANSFER_TIME BETWEEN #{dateStart} and #{dateEnd}
    </if>
    <if test='checkFlag != null and checkFlag =="0" '>
      AND b.defult_phone LIKE '%${keyWords}%'
    </if>
    <if test='checkFlag != null and checkFlag == "1" '>
      AND b.cust_name LIKE '%${keyWords}%'
    </if>
    GROUP BY b.cust_name
    order by a.TASK_CODE DESC
    limit 0,#{pageSize}
  </select>

  <!-- 更新任务状态 add by wangxiaoyu 2018-08-30-->
  <update id="updateTaskStatus" parameterType="cn.cucsi.bsd.ucc.data.domain.TaskTransfer">
    update OC_TASK_DETAIL
    <set>
      TASK_STATUS=#{transferStatus}
    </set>
    where TASK_DETAIL_ID=#{taskDetailId}
  </update>


  <!-- 根据businessCode、domainId查询任务明细表 add by wangxiaoyu 2018-08-30-->
  <select id="selectDetailByCriteria" resultMap="BaseResultMap" parameterType="cn.cucsi.bsd.ucc.common.beans.ShowTaskDetailCriteria">
    SELECT
      a.TASK_DETAIL_ID,
      a.USER_ID,
      a.BUSINESS_CODE
    FROM
      OC_TASK_DETAIL AS a
    where 1=1
    AND a.BUSINESS_CODE = #{businessCode,jdbcType=VARCHAR}
    AND a.domain_id = #{domainId,jdbcType=VARCHAR}
  </select>


  <!-- 根据userId获取待办任务数量 add by wangxiaoyu 2018-09-01-->
  <select id="selectPendingTaskCounts" resultType="int" parameterType="cn.cucsi.bsd.ucc.common.beans.OngoingTaskCriteria">
   SELECT
	  count(d.TASK_DETAIL_ID)
   FROM
	  OC_TASK_DETAIL as d
	  LEFT JOIN ucc_users AS uu ON d.USER_ID = uu.user_id and d.domain_id = uu.domain_id
   WHERE d.TASK_STATUS = '2'
   AND d.USER_ID = #{userId,jdbcType=VARCHAR}
  </select>

  <!-- 根据userId获取在办任务数量 add by wangxiaoyu 2018-09-01-->
  <select id="selectToGoTaskCounts" resultType="int" parameterType="cn.cucsi.bsd.ucc.common.beans.OngoingTaskCriteria">
    SELECT
      count(d.TASK_DETAIL_ID)
    FROM
      OC_TASK_DETAIL as d
      LEFT JOIN ucc_users AS uu ON d.USER_ID = uu.user_id and d.domain_id = uu.domain_id
    WHERE d.TASK_STATUS = '3'
    AND d.USER_ID = #{userId,jdbcType=VARCHAR}
  </select>

  <!-- 根据userId获取本月办结任务数量 add by wangxiaoyu 2018-09-01-->
  <select id="selectCompletedTaskCounts" resultType="int" parameterType="java.util.Map">
    SELECT
	   count(d.TASK_RECORD_ID)
    FROM
	   OC_TASK_RECORD as d
    LEFT JOIN OC_TASK_TRANSFER_RECORD as r ON d.TASK_RECORD_ID = r.TASK_RECORD_ID
    LEFT JOIN ucc_users AS uu ON d.OPERATOR_ID = uu.user_id and d.domain_id = uu.domain_id
    WHERE
	   r.TRANSFER_STATUS = '4'
    AND r.TRANSFER_TIME BETWEEN #{dateStart} and #{dateEnd}
    AND d.OPERATOR_ID = #{userId,jdbcType=VARCHAR}
  </select>

  <!-- 按批次删除数据 -->
  <delete id="deleteBYBatch" parameterType="java.util.Map">
    delete from
      OC_TASK_DETAIL
    where IMPORT_BATCH = #{oldTaskBatch} and TASK_STATUS not
    in ('4')
  </delete>

  <!-- 查询明细表中客户信息部分 -->
  <select id="getCustomerInfo" resultMap="BaseResultMap">
    select
      d.BUSINESS_CODE
      BUSINESS_CODE,
      d.CONTACTS CONTACTS,
      d.STATUS STATUS,
      d.INSTALLED_ADDRESS
      INSTALLED_ADDRESS,
      d.PON_LOGO PON_LOGO,
      d.TARIFF_NAME TARIFF_NAME,
      d.USER_NAME USER_NAME,
      d.PHONE_NUMBER PHONE_NUMBER,
      d.PHONE_NUMBER2
      PHONE_NUMBER2,
      d.PHONE_NUMBER3 PHONE_NUMBER3
    from OC_TASK_DETAIL d
    where
    d.TASK_STATUS = '0'
  </select>

  <!-- 分页查询 -->
  <sql id="Sql_Where">
    <if test="businessCode != null and businessCode != ''">
      and d.BUSINESS_CODE LIKE '%${businessCode}%'
    </if>
    <if test="taskTypeName != null and taskTypeName != ''">
      and d.TASK_TYPE_ID = #{taskTypeName}
    </if>
    <if test="deptMeshName != null and deptMeshName != ''">
      and p1.dept_name LIKE '%${deptMeshName}%'
    </if>
    <if test="deptAreaName != null and deptAreaName != ''">
      and p2.dept_name LIKE '%${deptAreaName}%'
    </if>
    <if test="developmentDeptName != null and developmentDeptName != ''">
      and p3.dept_name LIKE '%${developmentDeptName}%'
    </if>
    <if test="roperateDeptId != null and roperateDeptId != ''">
      and <![CDATA[ d.ROPERATE_DEPT_ID in (${roperateDeptId}) ]]>
    </if>
    <if test="taskStatus != null and taskStatus != ''">
      and (d.TASK_STATUS = #{taskStatus} or d.TASK_STATUS = '5')
    </if>
    <if test="taskStatusList != null">
      and (d.TASK_STATUS in (${taskStatusList}) or d.TASK_STATUS = '5')
    </if>
    <if test="taskTypeId != null and taskTypeId != ''">
      and d.TASK_TYPE_ID = #{taskTypeId}
    </if>
    <if test="taskCode != null and taskCode != ''">
      and d.TASK_CODE LIKE '%${taskCode}%'
    </if>
    <if test="defultPhone != null and defultPhone != ''">
      and d.DEFULT_PHONE LIKE '%${defultPhone}%'
    </if>
    <if test="userName != null and userName != ''">
      and c.cust_name LIKE '%${userName}%'
    </if>
    <if test="importPersonId != null and importPersonId != ''">
      and d.IMPORT_PERSON_ID = #{importPersonId}
    </if>
    <if test="barchs != null and barchs != ''">
      and d.IMPORT_BATCH in (${barchs})
    </if>
  </sql>

  <!-- 条件查询 -->
  <select id="selectByWhere" resultMap="BaseResultMap" parameterType="java.util.Map">
    select
      <include refid="Base_Column_List" />
    from OC_TASK_DETAIL d
    where 1=1
      <include refid="Sql_Where" />
    order by d.TASK_CODE DESC
  </select>

  <!-- 分派任务列表 -->
  <sql id="Sql_AllocationWhere">
    <if test="domainId != null and domainId != ''">
      and d.domain_id = #{domainId}
    </if>
    <if test="businessCode != null and businessCode != ''">
      and d.BUSINESS_CODE = #{businessCode}
    </if>
    <if test="deptMeshName != null and deptMeshName != ''">
      and p1.dept_name LIKE '%${deptMeshName}%'
    </if>
    <if test="deptAreaName != null and deptAreaName != ''">
      and p2.dept_name LIKE '%${deptAreaName}%'
    </if>
    <if test="developmentDeptName != null and developmentDeptName != ''">
      and p3.dept_name LIKE '%${developmentDeptName}%'
    </if>
    <if test="roperateDeptId != null and roperateDeptId != ''">
      and <![CDATA[ d.ROPERATE_DEPT_ID in (${roperateDeptId}) ]]>
    </if>
    <if test="taskStatus != null and taskStatus != ''">
      and (d.TASK_STATUS = #{taskStatus} or d.TASK_STATUS = '5')
    </if>
    <if test="taskStatusList != null">
      and (d.TASK_STATUS in (${taskStatusList}) or d.TASK_STATUS = '5')
    </if>
    <if test="taskTypeId != null and taskTypeId != ''">
      and d.TASK_TYPE_ID = #{taskTypeId}
    </if>
    <if test="taskCode != null and taskCode != ''">
      and d.TASK_CODE = #{taskCode}
    </if>
    <if test="defultPhone != null and defultPhone != ''">
      and d.DEFULT_PHONE LIKE '%${defultPhone}%'
    </if>
    <if test="userName != null and userName != ''">
      and c.cust_name LIKE '%${userName}%'
    </if>
    <if test="importPersonId != null and importPersonId != ''">
      and d.IMPORT_PERSON_ID = #{importPersonId}
    </if>
  </sql>

  <select id="selectImportBatchsBySearch" resultMap="BaseResultMap"
          parameterType="cn.cucsi.bsd.ucc.common.beans.TaskDetailSearch">
    SELECT DISTINCT
      IMPORT_BATCH
    FROM
      OC_TASK_DETAIL d
      LEFT JOIN ucc_depts p1 ON d.DEPT_MESH_ID = p1.dept_id
      LEFT JOIN ucc_depts p2 ON d.DEPT_AREA_ID = p2.dept_id
      LEFT JOIN ucc_depts p3 ON d.DEVELOPMENT_DEPT = p3.dept_id
    WHERE
      1 = 1
    <include refid="Sql_AllocationWhere" />
  </select>

  <select id="selectBySearchCount" resultType="int"
          parameterType="cn.cucsi.bsd.ucc.common.beans.TaskDetailSearch">
    SELECT
      count(d.TASK_DETAIL_ID)
    FROM
      OC_TASK_DETAIL d
      LEFT JOIN ucc_depts p1 ON d.DEPT_MESH_ID = p1.dept_id
      LEFT JOIN ucc_depts p2 ON d.DEPT_AREA_ID = p2.dept_id
      LEFT JOIN ucc_depts p3 ON d.DEVELOPMENT_DEPT = p3.dept_id
      LEFT JOIN ucc_depts p4 on d.ROPERATE_DEPT_ID = p4.dept_id
      LEFT JOIN OC_TASK_TYPE e ON e.TASK_TYPE_ID = d.TASK_TYPE_ID
    WHERE
    1 = 1
    <include refid="Sql_AllocationWhere" />
    <if test="importBatch != null and importBatch != ''">
      and d.IMPORT_BATCH = #{importBatch}
    </if>
  </select>

  <select id="selectBySearch" resultMap="BaseResultMap"
          parameterType="cn.cucsi.bsd.ucc.common.beans.TaskDetailSearch">
    SELECT
      TASK_DETAIL_ID,
      BUSINESS_CODE,
      DEPT_MESH_ID,
      DEPT_AREA_ID,
      DEVELOPMENT_DEPT,
      TASK_CODE,
      p1.dept_name DEPT_MESH_NAME,
      p2.dept_name DEPT_AREA_NAME,
      p3.dept_name DEVELOPMENT_DEPT_NAME,
      e.TASK_TYPE_NAME TASK_TYPE_NAME,
      TASK_STATUS,
      p4.dept_name dept_name
    FROM
      OC_TASK_DETAIL d
      LEFT JOIN ucc_depts p1 ON d.DEPT_MESH_ID = p1.dept_id
      LEFT JOIN ucc_depts p2 ON d.DEPT_AREA_ID = p2.dept_id
      LEFT JOIN ucc_depts p3 ON d.DEVELOPMENT_DEPT = p3.dept_id
      LEFT JOIN ucc_depts p4 on d.ROPERATE_DEPT_ID = p4.dept_id
      LEFT JOIN OC_TASK_TYPE e ON e.TASK_TYPE_ID = d.TASK_TYPE_ID
    WHERE
      1 = 1
    <include refid="Sql_AllocationWhere" />
    <if test="importBatch != null and importBatch != ''">
      and d.IMPORT_BATCH = #{importBatch}
    </if>
    order by d.TASK_CODE DESC
    <if test="begin != null and showLines != null and showLines != 0">
      limit #{begin},#{showLines}
    </if>
  </select>

  <select id="selectTaskDetailIdBySearch" resultType="string"
          parameterType="cn.cucsi.bsd.ucc.common.beans.TaskDetailSearch">
    SELECT
      TASK_DETAIL_ID
    FROM
      OC_TASK_DETAIL d
      LEFT JOIN ucc_depts p1 ON d.DEPT_MESH_ID = p1.dept_id
      LEFT JOIN ucc_depts p2 ON d.DEPT_AREA_ID = p2.dept_id
      LEFT JOIN ucc_depts p3 ON d.DEVELOPMENT_DEPT = p3.dept_id
    WHERE
      1 = 1
    <include refid="Sql_AllocationWhere" />
    <if test="importBatch != null and importBatch != ''">
      and d.IMPORT_BATCH = #{importBatch}
    </if>
    order by d.TASK_CODE DESC
  </select>

  <!-- 任务组织机构修改 -->
  <update id="editTaskDept" parameterType="java.util.Map">
    update OC_TASK_DETAIL
    <set>
      <if test="meshID != null and meshID != ''">
        DEPT_MESH_ID = #{meshID},
      </if>
      <if test="areaID != null and areaID != ''">
        DEPT_AREA_ID = #{areaID},
      </if>
      <if test="developmentID != null and developmentID != ''">
        DEVELOPMENT_DEPT = #{developmentID},
      </if>
    </set>
    where TASK_DETAIL_ID in ( ${taskDetailIds} )
  </update>

  <!-- 待办任务列表 -->
  <select id="selectwaitBySearchCount" resultType="int"
          parameterType="cn.cucsi.bsd.ucc.common.beans.TaskDetailSearch">
    SELECT
      count(d.TASK_DETAIL_ID)
    FROM
      OC_TASK_DETAIL d
      LEFT JOIN ucc_customers c ON d.BUSINESS_CODE = c.businesscode and d.domain_id = c.domain_id
      LEFT JOIN OC_TASK_TYPE as o on d.TASK_TYPE_ID = o.TASK_TYPE_ID
    WHERE
      1 = 1
    <include refid="Sql_AllocationWhere" />
  </select>

  <select id="selectwaitBySearch" resultMap="BaseResultMap"
          parameterType="cn.cucsi.bsd.ucc.common.beans.TaskDetailSearch">
    SELECT
      d.TASK_DETAIL_ID,
      d.BUSINESS_CODE,
      o.TASK_TYPE_NAME,
      d.DEPT_MESH_ID,
      d.DEPT_AREA_ID,
      d.DEVELOPMENT_DEPT,
      d.TASK_CODE,
      c.cust_name AS USER_NAME,
      d.USER_ID,
      d.domain_id,
      d.DEFULT_PHONE,
      d.TASK_STATUS
    FROM
      OC_TASK_DETAIL d
      LEFT JOIN ucc_customers c ON d.BUSINESS_CODE = c.businesscode and d.domain_id = c.domain_id
      LEFT JOIN OC_TASK_TYPE as o on d.TASK_TYPE_ID = o.TASK_TYPE_ID
    WHERE
    1 = 1
    <include refid="Sql_AllocationWhere" />
    order by d.TASK_CODE DESC
    <if test="begin != null and showLines != null and showLines != 0">
      limit #{begin},#{showLines}
    </if>
  </select>

  <select id="selectWaitTaskDetailIdBySearch" resultType="string"
          parameterType="cn.cucsi.bsd.ucc.common.beans.TaskDetailSearch">
    SELECT
      d.TASK_DETAIL_ID
      FROM
      OC_TASK_DETAIL d
      LEFT JOIN ucc_customers c ON d.BUSINESS_CODE = c.businesscode and d.domain_id = c.domain_id
    WHERE 1=1
    <include refid="Sql_AllocationWhere" />
  </select>

  <update id="updateTaskByTaskDetail" parameterType="cn.cucsi.bsd.ucc.data.domain.TaskDetail">
    update OC_TASK_DETAIL
    <set>
      TASK_STATUS=#{status},
      END_DATE=#{endDate},
      ROPERATE_DEPT_ID=#{roperateDeptId},
      check_flag=#{checkFlag}
    </set>
    where TASK_DETAIL_ID=#{taskDetailId}
  </update>

  <!-- 批量插入 -->
  <insert id="insertGroup" parameterType="map">
    insert into OC_TASK_DETAIL (TASK_DETAIL_ID, BUSINESS_CODE,
    TASK_TYPE_ID, DEPT_MESH_ID,
    DEPT_AREA_ID, DEPT_AGENCY_ID, TASK_CODE,
    PRODUCT_TYPE, PHONE_NUMBER, RATE,
    CUSTOMFIELDS1, CUSTOMFIELDS2,
    CUSTOMFIELDS3,
    CUSTOMFIELDS4, CUSTOMFIELDS5, CUSTOMFIELDS6,
    CUSTOMFIELDS7, CUSTOMFIELDS8, CUSTOMFIELDS9,
    CUSTOMFIELDS10,
    CUSTOMFIELDS11, CUSTOMFIELDS12,
    CUSTOMFIELDS13, CUSTOMFIELDS14,
    CUSTOMFIELDS15,
    RESPONSIBLE, NET_STOP, PACKAGE_NAME,
    CONTRACT_NAME,
    CONTRACT_START_TIME, CONTRACT_END_TIME,
    ACTIVATION_TIME,
    DEVELOPMENT_DEPT,
    IMPORT_BATCH, IMPORT_PERSON_ID, IMPORT_TIME,
    CONTACTS,
    STATUS, INSTALLED_ADDRESS, PON_LOGO, TARIFF_NAME,
    PHONE_NUMBER2,
    PHONE_NUMBER3,
    TASK_STATUS, ROPERATE_DEPT_ID,
    DEFULT_PHONE, USER_NAME, INIT_DEVELOPMENT, INIT_MESH_ID, INIT_AREA_ID,USER_ID,domain_id)
    values
    <foreach collection="list" item="record" index="index"
             separator=",">
      (#{record.taskDetailId,jdbcType=VARCHAR},
      #{record.businessCode,jdbcType=VARCHAR},
      #{record.taskTypeId,jdbcType=VARCHAR},
      #{record.deptMeshId,jdbcType=VARCHAR},
      #{record.deptAreaId,jdbcType=VARCHAR},
      #{record.deptAgencyId,jdbcType=VARCHAR},
      #{record.taskCode,jdbcType=VARCHAR},
      #{record.productType,jdbcType=VARCHAR},
      #{record.phoneNumber,jdbcType=VARCHAR},
      #{record.rate,jdbcType=VARCHAR},
      #{record.customfields1,jdbcType=VARCHAR},
      #{record.customfields2,jdbcType=VARCHAR},
      #{record.customfields3,jdbcType=VARCHAR},
      #{record.customfields4,jdbcType=VARCHAR},
      #{record.customfields5,jdbcType=VARCHAR},
      #{record.customfields6,jdbcType=VARCHAR},
      #{record.customfields7,jdbcType=VARCHAR},
      #{record.customfields8,jdbcType=VARCHAR},
      #{record.customfields9,jdbcType=VARCHAR},
      #{record.customfields10,jdbcType=VARCHAR},
      #{record.customfields11,jdbcType=VARCHAR},
      #{record.customfields12,jdbcType=VARCHAR},
      #{record.customfields13,jdbcType=VARCHAR},
      #{record.customfields14,jdbcType=VARCHAR},
      #{record.customfields15,jdbcType=VARCHAR},
      #{record.responsible,jdbcType=VARCHAR},
      #{record.netStop,jdbcType=VARCHAR},
      #{record.packageName,jdbcType=VARCHAR},
      #{record.contractName,jdbcType=VARCHAR},
      #{record.contractStartTime,jdbcType=VARCHAR},
      #{record.contractEndTime,jdbcType=VARCHAR},
      #{record.activationTime,jdbcType=VARCHAR},
      #{record.developmentDept,jdbcType=VARCHAR},
      #{record.importBatch,jdbcType=VARCHAR},
      #{record.importPersonId,jdbcType=VARCHAR},
      #{record.importTime,jdbcType=TIMESTAMP},
      #{record.contacts,jdbcType=VARCHAR},
      #{record.status,jdbcType=VARCHAR},
      #{record.installedAddress,jdbcType=VARCHAR},
      #{record.ponLogo,jdbcType=VARCHAR},
      #{record.tariffName,jdbcType=VARCHAR},
      #{record.phoneNumber2,jdbcType=VARCHAR},
      #{record.phoneNumber3,jdbcType=VARCHAR},
      #{record.taskStatus,jdbcType=VARCHAR},
      #{record.roperateDeptId,jdbcType=VARCHAR},
      #{record.defultPhone,jdbcType=VARCHAR},
      #{record.userName,jdbcType=VARCHAR},
      #{record.initDevelopment,jdbcType=VARCHAR},
      #{record.initMeshId,jdbcType=VARCHAR},
      #{record.initAreaId,jdbcType=VARCHAR},
      #{record.userId,jdbcType=VARCHAR},
      #{record.domainId,jdbcType=VARCHAR})
    </foreach>
  </insert>

  <!-- 查询外呼任务列表 web用-->
  <select id="selectDetailByCode" resultMap="BaseResultMap"
          parameterType="java.util.Map">
    SELECT
      d.*, tt.TASK_TYPE_NAME
    FROM
      OC_TASK_DETAIL d
      INNER JOIN OC_TASK_TYPE tt ON d.TASK_TYPE_ID = tt.TASK_TYPE_ID
    WHERE
      1 = 1
    AND d.TASK_STATUS IN ('2', '3')
    <include refid="Sql_Where" />
    order by d.TASK_CODE DESC
  </select>

  <!-- 批量删除 -->
  <delete id="deleteWithListId" parameterType="java.util.List">
    DELETE FROM OC_TASK_DETAIL where TASK_DETAIL_ID in
    <foreach collection="list" index="index" item="item" open="("
             separator="," close=")">
      #{item.taskRecordId}
    </foreach>
  </delete>

  <!-- 待办任务总量  zss (移植自outcall)-->
  <select id="selectWaitAllCount" resultType="int" parameterType="java.util.Map">
    select
    count(d.TASK_DETAIL_ID)
    from OC_TASK_DETAIL d
    where (d.TASK_STATUS = '1')
    <if test="deptIds !=null and deptIds!=''">
      and ROPERATE_DEPT_ID in (${deptIds})
    </if>
    and d.domain_id = #{domainId}
  </select>
  <!-- 在办任务总量  zss (移植自outcall)-->
  <select id="selectOngoingAllCount" resultType="int" parameterType="java.util.Map">
    select
    count(d.TASK_DETAIL_ID)
    from
    OC_TASK_DETAIL d
    where 1=1
    <if test="deptIds !=null and deptIds!=''">
     AND d.ROPERATE_DEPT_ID in (${deptIds})
    </if>
    and (d.TASK_STATUS = '3' or d.TASK_STATUS = '2') and d.domain_id = #{domainId}
  </select>
  <!-- 今日新增待办任务量   zss (移植自outcall)-->
  <select id="selectWaitTodayCount" resultType="int" parameterType="java.util.Map">
    select
    count(distinct d.TASK_DETAIL_ID)
    from
    OC_TASK_DETAIL d
    left join
    OC_TASK_TRANSFER r on d.TASK_DETAIL_ID = r.TASK_DETAIL_ID and r.TRANSFER_STATUS = d.TASK_STATUS
    where (d.TASK_STATUS = '1')
    and r.TRANSFER_TIME between #{dateStart} and #{dateEnd}
    <if test="deptIds !=null and deptIds!=''">
      and d.ROPERATE_DEPT_ID in (${deptIds})
    </if>
      and d.domain_id = #{domainId}
  </select>
  <!-- 办理过但是没办完的任务数量   zss (移植自outcall)-->
  <select id="selectOngoingNoCount" resultType="int" parameterType="java.util.Map">
    select
    count(d.TASK_DETAIL_ID)
    from
    OC_TASK_DETAIL d
    where 1=1
    <if test="deptIds!=null and deptIds!=''">
      and d.ROPERATE_DEPT_ID in (${deptIds})
    </if>
    and d.TASK_STATUS = '3'  and d.domain_id = #{domainId}
  </select>
  <!-- 本月办结任务数量  zss (移植自outcall)-->
  <select id="selectCompleteByDaysCount" resultType="int" parameterType="java.util.Map">
    select
    count(d.TASK_RECORD_ID)
    from
    OC_TASK_RECORD d
    left join
    OC_TASK_TRANSFER_RECORD r on d.TASK_RECORD_ID = r.TASK_RECORD_ID
    where r.TRANSFER_STATUS = '4'
    and r.TRANSFER_TIME between #{dateStart} and #{dateEnd}
    <if test="deptIds != null and deptIds!=''">
      and d.OPERATOR_DEPT in (${deptIds})
    </if>
     and d.domain_id = #{domainId}
  </select>
  <!-- 今日办结任务数量   zss (移植自outcall)-->
  <select id="selectCompleteTodayCount" resultType="int" parameterType="java.util.Map">
    select
    count(d.TASK_RECORD_ID)
    from
    OC_TASK_RECORD d
    left join
    OC_TASK_TRANSFER_RECORD r on d.TASK_RECORD_ID = r.TASK_RECORD_ID
    where r.TRANSFER_STATUS = '4'
    and r.TRANSFER_TIME between #{dateStart} and #{dateEnd}
    <if test="deptIds!=null and deptIds!=''">
      and d.OPERATOR_DEPT in (${deptIds})
    </if>
     and d.domain_id = #{domainId}
  </select>
  <!-- 查询一天的完成任务数   zss (移植自outcall)-->
  <select id="queryCompleteTask" resultType="int" parameterType="java.util.Map">
    select count(*)
    from OC_TASK_RECORD d
    inner join
    OC_TASK_TRANSFER_RECORD r ON d.TASK_RECORD_ID = r.TASK_RECORD_ID and r.TRANSFER_STATUS = '4'
    where
    <![CDATA[
		 	r.ROPERATE_DEPT_ID in (${deptIds})
		 	and TRANSFER_TIME between #{dateStart} and #{dateEnd}
		 ]]> and d.domain_id = #{domainId}
  </select>
  <!-- 查询一天的有效电话任务数   zss (移植自outcall)-->
  <select id="queryECall" resultType="int" parameterType="java.util.Map">
    select count(*)
    from OC_TASK_RECORD d
    inner join
    OC_TASK_TRANSFER_RECORD r ON d.TASK_RECORD_ID = r.TASK_RECORD_ID and r.TRANSFER_STATUS = '4'
    inner join pbx_cdrs c on c.cdr_id = r.CDR_ID
    where
    <![CDATA[
		 	r.ROPERATE_DEPT_ID in (${deptIds})
		 	and c.call_time>=5 and
         	TRANSFER_TIME between #{dateStart} and #{dateEnd}
         ]]> and d.domain_id = #{domainId}
  </select>
  <!-- 查询一天的所有外呼任务数   zss (移植自outcall)-->
  <select id="queryACall" resultType="int" parameterType="java.util.Map">
    select count(*)
    from OC_TASK_RECORD d
    inner join
    OC_TASK_TRANSFER_RECORD r ON d.TASK_RECORD_ID = r.TASK_RECORD_ID and r.TRANSFER_STATUS = '4'
    inner join pbx_cdrs c on c.cdr_id = r.CDR_ID
    where
    <![CDATA[
		 	r.ROPERATE_DEPT_ID in (${deptIds})
		 	and TRANSFER_TIME between #{dateStart} and #{dateEnd}
         ]]> and d.domain_id = #{domainId}
  </select>

    <!-- 任务监控列表 -->
    <sql id="Sql_MonitorWhere">
        <if test="businessCode != null and businessCode != ''">
            and d.BUSINESS_CODE LIKE '%${businessCode}%'
        </if>
        <if test="taskTypeName != null and taskTypeName != ''">
            and e.TASK_TYPE_NAME LIKE '%${taskTypeName}%'
        </if>
        <if test="deptMeshName != null and deptMeshName != ''">
            and p1.dept_name LIKE '%${deptMeshName}%'
        </if>
        <if test="deptAreaName != null and deptAreaName != ''">
            and p2.dept_name LIKE '%${deptAreaName}%'
        </if>
        <if test="developmentDeptName != null and developmentDeptName != ''">
            and p3.dept_name LIKE '%${developmentDeptName}%'
        </if>
        <if test="taskStatus != null and taskStatus != ''">
            and d.TASK_STATUS = #{taskStatus}
        </if>
        <if test="taskTypeId != null and taskTypeId != ''">
            and d.TASK_TYPE_ID = #{taskTypeId}
        </if>
        <if test="defultPhone != null and defultPhone != ''">
            and d.DEFULT_PHONE LIKE '%${defultPhone}%'
        </if>
        <if test="userName != null and userName != ''">
            and c.cust_name LIKE '%${userName}%'
        </if>
        <if test="taskCode != null and taskCode != ''">
            and d.TASK_CODE LIKE '%${taskCode}%'
        </if>
        <if test="deptIdAndChildIds != null and deptIdAndChildIds != ''">
            and d.ROPERATE_DEPT_ID in (${deptIdAndChildIds})
        </if>
    </sql>

    <select id="selectMonitorBySearchSearchCount" resultType="int"
            parameterType="cn.cucsi.bsd.ucc.common.beans.TaskDetailSearch">
        SELECT
          count(d.TASK_DETAIL_ID)
        FROM
          OC_TASK_DETAIL d
          LEFT JOIN ucc_customers c ON d.BUSINESS_CODE = c.businesscode and d.domain_id = c.domain_id
          INNER JOIN OC_TASK_TRANSFER r ON d.TASK_DETAIL_ID = r.TASK_DETAIL_ID
        AND r.TRANSFER_STATUS = d.TASK_STATUS
            LEFT JOIN ucc_users u ON u.user_id = r.OPERATOR_ID
            LEFT JOIN ucc_depts p ON p.dept_id = r.OPERATOR_DEPT
            LEFT JOIN ucc_depts p1 ON d.DEPT_MESH_ID = p1.dept_id
            LEFT JOIN ucc_depts p2 ON d.DEPT_AREA_ID = p2.dept_id
            LEFT JOIN OC_TASK_TYPE e ON e.TASK_TYPE_ID = d.TASK_TYPE_ID
        WHERE
          1 = 1
        <if test="beginTime != null and beginTime != ''">
            and  DATE_FORMAT(TRANSFER_TIME,'%Y-%m-%d') &gt;= #{beginTime}
        </if>
        <if test="endTime != null and endTime != ''">
            and  DATE_FORMAT(TRANSFER_TIME,'%Y-%m-%d') &lt;= #{endTime}
        </if>
        <include refid="Sql_MonitorWhere" />
    </select>

    <select id="selectMonitorBySearch" resultMap="BaseResultMap"
            parameterType="cn.cucsi.bsd.ucc.common.beans.TaskDetailSearch">
        SELECT
            d.TASK_CODE TASK_CODE,
            e.TASK_TYPE_NAME TASK_TYPE_NAME,
            d.TASK_STATUS TASK_STATUS,
            d.BUSINESS_CODE BUSINESS_CODE,
            c.cust_name USER_NAME,
            d.DEFULT_PHONE DEFULT_PHONE,
            u.nick_name nick_name,
            p.dept_name dept_name,
            r.TRANSFER_TIME TRANSFER_TIME,
            d.TASK_DETAIL_ID TASK_DETAIL_ID,
            d.DEPT_MESH_ID DEPT_MESH_ID,
            d.DEPT_AREA_ID DEPT_AREA_ID,
            p1.dept_name DEPT_MESH_NAME,
            p2.dept_name DEPT_AREA_NAME
        FROM
            OC_TASK_DETAIL d
            LEFT JOIN ucc_customers c ON d.BUSINESS_CODE = c.businesscode
            AND d.domain_id = c.domain_id
            INNER JOIN OC_TASK_TRANSFER r ON d.TASK_DETAIL_ID = r.TASK_DETAIL_ID
            AND r.TRANSFER_STATUS = d.TASK_STATUS
            LEFT JOIN ucc_users u ON u.user_id = r.OPERATOR_ID
            LEFT JOIN ucc_depts p ON p.dept_id = r.OPERATOR_DEPT
            LEFT JOIN ucc_depts p1 ON d.DEPT_MESH_ID = p1.dept_id
            LEFT JOIN ucc_depts p2 ON d.DEPT_AREA_ID = p2.dept_id
            LEFT JOIN OC_TASK_TYPE e ON e.TASK_TYPE_ID = d.TASK_TYPE_ID
        WHERE
          1 = 1
        <if test="beginTime != null and beginTime != ''">
            and  DATE_FORMAT(TRANSFER_TIME,'%Y-%m-%d') &gt;= #{beginTime}
        </if>
        <if test="endTime != null and endTime != ''">
            and  DATE_FORMAT(TRANSFER_TIME,'%Y-%m-%d') &lt;= #{endTime}
        </if>
        <include refid="Sql_MonitorWhere" />
        order by d.TASK_STATUS, d.TASK_CODE DESC
        <if test="begin != null and showLines != null and showLines != 0">
            limit #{begin},#{showLines}
        </if>
    </select>

    <select id="selectTaskDetailIdByMonitorSearch" resultType="java.lang.String"
            parameterType="cn.cucsi.bsd.ucc.common.beans.TaskDetailSearch">
        SELECT
          d.TASK_DETAIL_ID TASK_DETAIL_ID
        FROM
          OC_TASK_DETAIL d
            LEFT JOIN ucc_customers c ON d.BUSINESS_CODE = c.businesscode
            INNER JOIN OC_TASK_TRANSFER r ON d.TASK_DETAIL_ID = r.TASK_DETAIL_ID
            AND r.TRANSFER_STATUS = d.TASK_STATUS
            LEFT JOIN ucc_users u ON u.user_id = r.OPERATOR_ID
            LEFT JOIN ucc_depts p ON p.dept_id = r.OPERATOR_DEPT
            LEFT JOIN ucc_depts p1 ON d.DEPT_MESH_ID = p1.dept_id
            LEFT JOIN ucc_depts p2 ON d.DEPT_AREA_ID = p2.dept_id
            LEFT JOIN OC_TASK_TYPE e ON e.TASK_TYPE_ID = d.TASK_TYPE_ID
        WHERE
          1 = 1
        <if test="beginTime != null and beginTime != ''">
            and  DATE_FORMAT(TRANSFER_TIME,'%Y-%m-%d') &gt;= #{beginTime}
        </if>
        <if test="endTime != null and endTime != ''">
            and  DATE_FORMAT(TRANSFER_TIME,'%Y-%m-%d') &lt;= #{endTime}
        </if>
        <include refid="Sql_MonitorWhere" />
    </select>

    <!-- 办结任务列表 -->
    <select id="selectCompleteBySearchCount" resultType="int"
            parameterType="cn.cucsi.bsd.ucc.common.beans.TaskDetailSearch">
        SELECT
          count(d.TASK_DETAIL_ID)
        FROM
            OC_TASK_DETAIL d
            LEFT JOIN ucc_customers c ON d.BUSINESS_CODE = c.businesscode
            AND d.domain_id = c.domain_id
            LEFT JOIN OC_TASK_TRANSFER t ON d.TASK_DETAIL_ID = t.TASK_DETAIL_ID
        WHERE
            t.TRANSFER_STATUS = '4'
        <include refid="Sql_Where" />
    </select>
    <select id="selectCompleteBySearch" resultMap="BaseResultMap"
            parameterType="cn.cucsi.bsd.ucc.common.beans.TaskDetailSearch">
        SELECT
            d.TASK_DETAIL_ID,
            d.BUSINESS_CODE,
            d.TASK_TYPE_ID,
            d.DEPT_MESH_ID,
            d.DEPT_AREA_ID,
            d.DEVELOPMENT_DEPT,
            d.TASK_CODE,
            c.cust_name AS USER_NAME,
            d.DEFULT_PHONE,
            t.OPERATOR_ID OPERATOR_ID,
            t.TRANSFER_TIME TRANSFER_TIME
        FROM
            OC_TASK_DETAIL d
            LEFT JOIN ucc_customers c ON d.BUSINESS_CODE = c.businesscode
            LEFT JOIN OC_TASK_TRANSFER t ON d.TASK_DETAIL_ID = t.TASK_DETAIL_ID
        WHERE
          t.TRANSFER_STATUS = '4'
        <include refid="Sql_Where" />
        order by d.TASK_CODE DESC
        <if test="begin != null and showLines != null and showLines != 0">
            limit #{begin},#{showLines}
        </if>
    </select>

    <!-- 查询超过任务截止日期的任务状态更改为已办结   Add by bli 2017-02-03-->
    <select id="selectTaskStatusByEndDate" resultMap="BaseResultMap" parameterType="cn.cucsi.bsd.ucc.common.beans.TaskDetailSearch">
        select * from OC_TASK_DETAIL
        <where>
            <if test="endDateBeforeNow != null and endDateBeforeNow != ''">
                AND sysdate() <![CDATA[>]]> END_DATE
            </if>
            <if test="importBatch != null and importBatch != ''">
                AND IMPORT_BATCH = #{importBatch}
            </if>
            <if test="taskDetailIdInList != null">
                AND TASK_DETAIL_ID in
                <foreach item="myId" index="index" collection="taskDetailIdInList"
                         open="(" separator="," close=")">
                    #{myId}
                </foreach>
            </if>
        </where>
        LIMIT 5000
    </select>

  <select id="selDeptByUserIdFromTaskDetail" resultType="java.lang.String" parameterType="cn.cucsi.bsd.ucc.common.beans.TaskDetailSearch" >
    SELECT
        a.ROPERATE_DEPT_ID
    FROM
        OC_TASK_DETAIL AS a
    WHERE 1=1
    <if test="domainId != null and domainId != ''">
      AND a.domain_id = #{domainId,jdbcType=VARCHAR}
    </if>
    <if test="userId != null and userId != ''">
      AND a.USER_ID = #{userId,jdbcType=VARCHAR}
    </if>
    <if test="taskDetailId != null and taskDetailId != ''">
      AND a.TASK_DETAIL_ID = #{taskDetailId,jdbcType=VARCHAR}
    </if>
    <if test="taskDetailIds != null and taskDetailIds != ''">
      AND a.TASK_DETAIL_ID in ( ${taskDetailIds} )
    </if>
    <if test="taskDetailIdInList != null">
      AND a.TASK_DETAIL_ID in
      <foreach item="myId" index="index" collection="taskDetailIdInList"
               open="(" separator="," close=")">
        #{myId}
      </foreach>
    </if>
  </select>
</mapper>